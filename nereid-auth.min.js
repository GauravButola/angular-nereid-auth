"use strict";angular.module("openlabs.angular-nereid-auth",["base64"]).factory("nereidAuth",["$http","$base64",function($http,$base64){var apiBasePath="",loginTokenEndpoint="/login/token",userInfoEndpoint="/me",token=localStorage.getItem("token"),user={},setHeaders=function(token){return token?void($http.defaults.headers.common.Authorization="Token "+token.toString()):void delete $http.defaults.headers.common.Authorization},refreshUserInfo=function(){return $http.get(apiBasePath+userInfoEndpoint).success(function(data){angular.extend(user,data)})},isLoggedIn=function(){return token?!0:!1};token&&(setHeaders(token),refreshUserInfo().error(function(data,status){401==status&&logoutUser()}));var setToken=function(newToken){newToken?localStorage.setItem("token",newToken):localStorage.removeItem("token"),setHeaders(newToken),token=newToken},logoutUser=function(){setToken(null),user={}},login=function(email,password){var basic_auth=$base64.encode(email+":"+password);return $http.post(apiBasePath+loginTokenEndpoint,{},{headers:{Authorization:"Basic "+basic_auth,"X-Requested-With":"XMLHttpRequest"}}).success(function(data){setToken(data.token),user=data.user}).error(function(){logoutUser()})},self={setLoginEndpoint:function(new_end_point){loginTokenEndpoint=new_end_point},setUserInfoEndpoint:function(new_end_point){userInfoEndpoint=new_end_point},setapiBasePath:function(new_base_path){apiBasePath=new_base_path},login:login,logoutUser:logoutUser,user:user,refreshUserInfo:refreshUserInfo,isLoggedIn:isLoggedIn};return self}]).directive("showIfAuth",["$animate","nereidAuth",function($animate,nereidAuth){return function(scope,element){scope.$watch(function(){return nereidAuth.isLoggedIn()},function(){$animate[nereidAuth.isLoggedIn()?"removeClass":"addClass"](element,"ng-hide")})}}]).directive("hideIfAuth",["$animate","nereidAuth",function($animate,nereidAuth){return function(scope,element){scope.$watch(function(){return nereidAuth.isLoggedIn()},function(){$animate[nereidAuth.isLoggedIn()?"addClass":"removeClass"](element,"ng-hide")})}}]);