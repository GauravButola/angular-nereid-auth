"use strict";angular.module("openlabs.angular-nereid-auth",[]).factory("nereidAuth",["$http","$base64",function($http,$base64){var apiBasePath="",loginTokenEndpoint="/login/token",userInfoEndpoint="/me",token=localStorage.getItem("token"),user={},setHeaders=function(token){return token?void($http.defaults.headers.common.Authorization="Token "+token.toString()):void delete $http.defaults.headers.common.Authorization},refreshUserInfo=function(){return $http.get(apiBasePath+userInfoEndpoint).success(function(data){angular.extend(user,data)})};token&&(setHeaders(token),refreshUserInfo().error(function(){logoutUser()}));var setToken=function(token){token?localStorage.setItem("token",token):localStorage.removeItem("token"),setHeaders(token)},logoutUser=function(){setToken(null),user={}},login=function(email,password){var basic_auth=$base64.encode(email+":"+password);return $http.post(apiBasePath+loginTokenEndpoint,{},{headers:{Authorization:"Basic "+basic_auth,"X-Requested-With":"XMLHttpRequest"}}).success(function(data){setToken(data.token),refreshUserInfo()}).error(function(){logoutUser()})},self={setLoginEndpoint:function(new_end_point){loginTokenEndpoint=new_end_point},setUserInfoEndpoint:function(new_end_point){userInfoEndpoint=new_end_point},setapiBasePath:function(new_base_path){apiBasePath=new_base_path},login:login,logoutUser:logoutUser,user:user,refreshUserInfo:refreshUserInfo};return self}]);